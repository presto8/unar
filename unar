#!/usr/bin/env python

import argparse
import os
import sys
from collections import namedtuple


class Fail(Exception):
    pass


class ExtractArchiveResult(namedtuple("ExtractArchiveResult", "finaldir filecount")):
    pass


def scantree(path, follow_symlinks=False):
    for entry in os.scandir(path):
        if entry.is_dir(follow_symlinks=follow_symlinks):
            yield from scantree(entry.path, follow_symlinks=follow_symlinks)
        else:
            yield entry


# Returns paths sorted in ascending time (oldest first)
def scantree_mtime(path):
    entries = list(scantree(path))
    return sorted(entries, key=lambda x: x.stat().st_mtime)


def extract_archive(path) -> ExtractArchiveResult:
    return ExtractArchiveResult(finaldir="TODO", filecount=0)


def parse_args():
    parser = argparse.ArgumentParser()
    parser.add_argument('files', nargs='+', help='archive files to extract')
    parser.add_argument('--verbose', default=False, action='store_true', help='show more detailed messages')
    return parser.parse_args()


def main():
    for path in ARGS.files:
        result = extract_archive(path)
        print(f"{path} -> {result.finaldir} [{result.filecount} files]")


if __name__ == '__main__':
    try:
        ARGS = parse_args()
        main()
    except Fail as f:
        print(*f.args, file=sys.stderr)
        sys.exit(1)
    except KeyboardInterrupt:
        print("Ctrl+C")
